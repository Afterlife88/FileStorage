#File-storage
### DevChallenge 2016 fall, back-end semi-final round, pro category

## Демо
> - http://challenge-task.info

## Запуск приложения через загрузку образа с docker hub
> - **docker run -p 8080:5000 devchallenge/file-storage**
> - Запустите localhost:8080 в браузере, если порт занят, замените в docker run 8080 на любой другой порт и запустите команду еще раз.

## Альтернативный путь сборки и запуска через docker
> - `cd src\FileStorage.Web`
> - `bower install`
> - `cd ..\..\`
> - `docker build -t app .`
> - `docker run -p 8080:5000 -t app`

## Описание проекта
Проект являет собой сервис файлового хранилища, аналог веб-версии Dropbox, OneDrive и т.д. Доступ к файлам реализован через REST архитектуру.
Используемые технологии:
- **Серверная часть:** ASP.NET Core, Entity Framework Core, MS SQL, Swagger (для документации API), XUnit, Moq, AutoMapper (Entity => DTO), Windows Azure Storage (библиотека для взаимодействия с Azure BLOB хранилищем)
- **Клиент:** AngularJS, UI Bootstrap, angular-file-upload(для загрузки файлов), Bootstrap, font-awesome

## Описание структуры проекта
Проект выполнен в соответствии принципам Domain-Driven Design, в связи с этим решение разбито на 6 проектов, где есть строгое разграничение между Domain Entities, Data Access Layer, Buisness Layer, API, в итоге есть разграниченные слои, которые легко дополнять и масштабировать проект, соблюдены **SOLID** принципы при построении архитектуры решения. Обширную документацию к API можно просмотреть по адресу **/swagger**, там сразу можно будет потестить запросы к API. Клиент доступен по корневому URL и доступен сразу после запуска приложения.

Замечание: скачивания файла на Angular клиенте проверено на **Chrome** и **Firefox**.

## Описание работы проекта
Пользователь регистрируется в проекте, после этого ему предоставлена персональная корневая папка для загрузки файлов и создания папок. Пользователь может создать папку, загрузить файл в конкретную папку. Версионность файла реализована проверкой хэша, можно загрузить файл, потом изменить его у себя и загрузить еще раз - система поймет, что это новая версия и в контекстном окне пользователь может выбрать конкретную версию файла для скачивания. Можно перемещать файлы или папки (вместе с дочерними элементами), переименовывать файлы / папки. Так же можно удалить файл, после этого он будет доступен в течение 30 дней для восстановления и будет удален полностью после этого. Реализован функционал для поиска файлов / папок, в том числе, и среди удаленных. 

## Структура проекта
- **FileStorage.Domain** - хранит в себе сущности для ORM Entity Framework Core, на основе которых идет генерация базы данных.
- **FileStorage.DAL** - проект, который обеспечивает доступ к данным, "слой" между бизнес-логикой и средством хранения данных (MS Sql Server), хранит в себе реализацию **UnitOfWork** и **Repository** патернов. 
- **FileStorage.Services** - Buisness Layer приложение, обеспечивает workflow для бизнес-логики приложения, в папке **Contracts** содержатся абстракции, на которых строим зависимости в приложении. **Implementation** конкретные реализации и основания бизнес-логики.
- **FileStorage.Tests** - тесты для проекта, в папке **ServicesUnitTests** содержатся основные юнит-тесты для проверки бизнес-логики приложения.
- **FileStorage.Web** -  так как нужно было запускать через один docker контейнер, API и клиентская часть содержится на одном хосте. В папке **Controllers** 4 API контроллера и один Home контроллер для возвращения вьюхи на клиент и там уже использовать Angular. Контроллеры выполняют тривиальные функции: взять запрос - передать на сервис (business layer) - вернуть ответ, пришедший с сервиса. **Startup** файл содержит основную конфигурацию к **API** и **DI** контейнер, который регестрирует конкретные реализации к абстракциям. В папке **wwwroot/app** клиентское приложение с использованием AngularJS вы можете просмотреть его сразу после старта приложения. В папке **wwwroot/swagger** клиентская документация к API.

## Зависимости в проекте
- **FileStorage.DAL** -> FileStorage.Domain
- **FileStorage.Services** ->  FileStorage.DAL, FileStorage.Domain, FileStorage.Utils
- **FileStorage.Tests** -> FileStorage.Services, FileStorage.Web
- **FileStorage.Web** -> FileStorage.DAL, FileStorage.Services
