# Scalability

Все файлы хранятся на Azure Blob Storage, это, на мой взгляд, самый надежный способ хранения данных, Azure дает гарантию в том, что ни один файл не будет утерян. Но все же, чем больше файлов, тем больше денежних средств они просят. В этом случае можно повесить Azure Scheduler или подобную службу, которая сможет делать запросы по определенному таймауту (например каждый день в 00.00) для проверки файлов, которые находятся в корзине более месяца и удалить их полностью с баз и с хранилища. Для этого случая реализован недокументированный запрос */api/dailycheck*, который чекает все просроченные файлы и удаляет их.

Так же в будущем для улучшения производительности можно применить кэширование данных на стороне API с помощью применения атрибута **ResponseCache** на часто используемых запросах (например данные root папки юзера). Так же можно применить **Redis** как хранилище распределенного кэша, для применения в проекте нужно просто добавить на объекте **IServiceCollection** в Startup файле готовую реализацию **AddDistributedRedisCache** с указанием конфигурации и имени инстанса.

Для обработки большого количества поступаемых файлов эффективным было бы горизонтальное масштабирование, доп инcтансы IIS дадут нам большой прирост в производительности.

По дефолту Azure App Services дают веб-ферму и балансировщик нагрузки и одним из лучших вариантов было бы воспользоватся их сервисом для хостинга приложения. 

Эффективным способом улучшения перфоманса будет горизонтальное масштабирование с помощью **docker swarm** и балансировщика нагрузки. Для этого:
> - Инициализируем `docker swarm init`
> - Создаем сервис: `docker service create --publish 8080:5000 --name file-storage devchallenge/file-storage`
> - Скейлим приложение на 3 контейнера `docker service scale file-storage=3`
> - Для проверки пишем `docker ps` и убеждаемся в работе.

**Docker swarm** использует **Round-robin** алгоритм для распределения нагрузки между контейнерами.

После этого настроим обратный прокси на сервере. На конфигурации IIS выбираем **Add Rule(s)**, **Reverse proxy** и пишем туда адрес ноды докера с портом, который определили выше, по дефолту это **10.0.75.2:8080**. Готово.

Для уменьшения контейнеров используем:
> `docker service scale file-storage=0`

Для удаления сервиса:
> `docker service rm file-storage`
